{% extends "includes/layout.njk" %}

{% from "govuk/components/back-link/macro.njk"     import govukBackLink %}
{% from "govuk/components/input/macro.njk"         import govukInput %}
{% from "macros/title.njk"                         import title %}
{% from "macros/returnLink.njk"                    import returnLink %}
{% from "govuk/components/error-summary/macro.njk" import govukErrorSummary %}
{% from "govuk/components/button/macro.njk"        import govukButton %}
{% from "govuk/components/table/macro.njk" import govukTable %}

{% block pageTitle %}
    {{ pageTitle }}
{% endblock %}

{% block mainContent %}

   <div class="govuk-grid-row">
        <div class="govuk-grid-column-two-thirds">

            {% if form.errors.length > 0 %}
                {{ govukErrorSummary({
                    "titleText": messages("error.summary.title"),
                    "errorList": form.errors
                }) }}
            {% endif %}

            <h1 class="govuk-heading-xl">{{ messages("messages__listSchemes__title") }}</h1>

            <form method="post"
                  autocomplete="off"
                  action="{{ submitUrl }}"
                  novalidate>

                {{ csrf() | safe }}

                {% if schemes.size >= appConfig.minimumSchemeSearchResults or form.value %}
                    {{ govukInput({
                                       label: {
                                           text: messages('messages__listSchemes__searchText_label'),
                                           isPageHeading: false,
                                           classes: "govuk-label--m"
                                       },
                                       id: "value",
                                       name: "value",
                                       value: form.value.value,
                                       errorMessage: form.value.error
                                   }) }}

                    {{ govukButton({
                                       attributes: {id: "search"},
                                       text: messages("messages__listSchemes__search_submit")
                                   }) }}
                {% endif %}

                {% if form.value.value %}
                    <p>
                        <a id="clear-search-link" href="{{ clearLinkUrl }}">{{ messages("messages__listSchemes__searchText_clearlink") }}</a>
                    </p>
                {% endif %}
            </form>
        </div>
   </div>


    {% if form.value.value %}
                {% if schemesCount > 0 %}
                    <div class="grid-row">
                        <div class="column-two-thirds">
                            <p class="govuk-margin-top-5 govuk-margin-bottom-0">

                                    {% if schemesCount == 1 %}
                                       {{ messages("messages__listSchemes__search_result") }}
                                    {% else %}
                                       {{ messages("messages__listSchemes__search_multipleResults", schemesCount) }}
                                    {% endif %}

                            </p>
                        </div>
                    </div>
                {% endif %}

    {% endif %}



     {% if noResultsMessageKey %}
                <div class="grid-row">
                    <div class="column-two-thirds">
                        <p id="noSchemes">{{ messages(noResultsMessageKey) }}</p>
                    </div>
                </div>
     {% endif %}

     {% if schemes %}
              {{ govukTable(schemes) }}
     {% endif %}

    <p class="govuk-body"><a id="return_to_psa" href="{{ returnUrl }}" class="govuk-link">{{ messages("return.to.link", psaName) }}</a></p>

{% endblock %}
